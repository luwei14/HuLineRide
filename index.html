<html>
  <head>
    <meta charset="utf-8">
    <title>腾冲黑河线骑行-HuLineRide-人口分布线骑行</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.4.0/gpx.min.js"></script>
    <script src="china.js"></script>
    <style>
      html,body {
          margin:0px;
          padding:0px;
          font-size: 12px;
          font-family: sans-serif;
      }

      .gpx { 
          position: absolute;
          height: 100%;
       
          }
      .gpx header { padding: 0.5em;}
      .gpx h3 { margin: 0; padding: 0; font-weight: bold; }
      .gpx h2 { margin: 0; padding: 0; font-weight: bold; }
      .gpx .start { font-size: smaller; color: #444; }
      .gpx .map { border: 1px #888 solid; border-left: none; border-right: none;
        width: 100%; height: 89%; margin: 0;}
      .gpx footer { background: #f0f0f0; padding: 0.5em; }
      .gpx ul.info { list-style: none; margin: 0; padding: 0; }
      .gpx ul.info li { color: #666; padding: 0px; display: inline; }
      .gpx ul.info li span { color: black; }
    </style>
  </head>
  <body>
    
    <section id="all-seg-map" class="gpx" style="left: 0px; width: 100%;height: 100%;">
      <header>
        <h2>腾冲黑河线骑行轨迹总图</h2>
      </header>
      <article>
        <div class="map" id="mainmap"></div>
      </article>
      <footer>
        <ul class="info">
          <li>总距离:&nbsp;<span class="distance"></span>&nbsp;km</li>
          &mdash; <li>高度爬升:&nbsp;+<span class="elevation-gain"></span>&nbsp;m,
            -<span class="elevation-loss"></span>&nbsp;m
            (净值:&nbsp;<span class="elevation-net"></span>&nbsp;m)</li>
          &mdash; <li>总时间:&nbsp;<span class="duration"></span>&nbsp;h</li>
        </ul>
      </footer>
    </section>
    
    <script>
     
      var osmlyr = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; Map:<a href="http://osm.org/copyright">OpenStreetMap</a>'
      });

      var chinajson = L.geoJson(china);
      chinajson.setStyle({
          fillColor: "#ff0",
          fillOpacity: 0,
          weight: 1,
          opacity: 1
      }); 
      var map = L.map('mainmap',{
          center: [36, 106],
          zoom: 4,
          layers: [osmlyr,chinajson]
      });

      var gpxlist = ["S1.gpx","S2.gpx","S3.gpx","S4.gpx",
                     "S5.gpx","S6.gpx","S7.gpx","S8.gpx","T1.gpx","S9.gpx",
                     "S10.gpx","S11.gpx","S12.gpx"];
      var stops = [[25.0056960,98.4876900],[24.8693010,98.8971480],
                   [25.1083950,99.1618320],[25.4588190,99.5261690],
                   [25.7029900,100.1715920],[25.9236520,100.1872640],
                   [26.8673260,100.2347980],[27.2899570,100.8502780],
                   [27.7345870,100.7449730],[27.7190200,100.8720190],
                   [27.4268380,101.5007000],[27.8402410,102.2712610],
                   [28.5491060,102.1767830],[29.3637890,102.6292800]];
      var stops_names = ["腾冲市","怒江大桥",
                         "保山市","永平县",
                         "大理古城","双廊古镇",
                         "丽江古城","宁蒗彝族自治县",
                         "泸沽湖里格村","泸沽湖扎窝洛",
                         "盐源县","西昌市","冕宁县","汉源县"];

      var total_distance = 0.0;
      var total_elevation_gain= 0.0;
      var total_elevation_loss= 0.0;
      var total_time = 0.0;
      gpxlist.forEach(gpx => {
        gpx = "tracks/"+gpx;
        var gpxobj = new L.GPX(gpx, {
          async: true,
          marker_options: {
            startIconUrl: '',
            endIconUrl: '',
            shadowUrl: ''
          },
          polyline_options: {
            color: 'green',
            opacity: 1,
            weight: 2,
            lineCap: 'round'
          }
      }).on('loaded', function(e) {
        console.log(e);
        total_distance += gpxobj.get_distance()/1000;
        document.getElementsByClassName("distance")[0].textContent=total_distance.toFixed(2);
        total_elevation_gain += gpxobj.get_elevation_gain();
        document.getElementsByClassName("elevation-gain")[0].textContent=total_elevation_gain.toFixed(2);
        total_elevation_loss += gpxobj.get_elevation_loss();
        document.getElementsByClassName("elevation-loss")[0].textContent=total_elevation_loss.toFixed(2);

        document.getElementsByClassName("elevation-net")[0].textContent=(total_elevation_gain - total_elevation_loss).toFixed(2);

        total_time += gpxobj.get_total_time() / 1000./3600;
        document.getElementsByClassName("duration")[0].textContent=total_time.toFixed(2);

        console.log(gpxobj.get_name(),gpxobj.get_total_time()/1000./3600);
      }).on('click', function(e) { 
        //alert("click"); 
        console.log(e); 
      }).addTo(map);

      
      });
      
      
      for(var i=0;i<stops.length;++i)
      {
        var circle = L.circleMarker(stops[i], {
            color: '#FF9000',
            fillColor: '#FF9000',
            fillOpacity:1,
            radius: 2
        }).addTo(map);
      }
    
      var endstop = L.circleMarker([50.2451,127.5283],{
            color: 'red',
            fillColor: 'red',
            fillOpacity:1,
            radius: 5
      }).addTo(map);

      var latlngs = [
          [25.0056960,98.4876900],
          [50.2451,127.5283]
      ];
      latlngs = [
          [25.0056960,98.4876900],
          [50.2451,127.5283]
      ];
      var polyline = L.polyline(latlngs, {color: 'blue',weight:2}).addTo(map);

      
     
    </script>
  </body>
</html>
